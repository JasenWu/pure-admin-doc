---
title: 常见问题回答
date: 2022-01-18
permalink: /pages/f8dc77/
article: false
---

温馨提示：文件存放路径不要带有中文，文件存放路径不要带有中文，文件存放路径不要带有中文，中文会造成乱码！！！重要的事情说三遍
<img alt="smile" width="35px" height="35px" src="https://emojipedia-us.s3.amazonaws.com/source/skype/289/smiling-face-with-smiling-eyes_1f60a.png">

## 一：`Nuxt3` 版本和 `JS` 版本会开发吗？

- `Nuxt3` 版本  
  答：经过我实地检测，`nuxt3` 目前还有很多问题待修复，包括一些周边的库大多数都不兼容，感觉要稳定的话还得等大半年及以上

- `JS` 版本  
  答：我认为 `ts` 也该学学了，并不复杂，或许您花一个星期都能掌握，如果谁想开发 `js` 版本欢迎 `pr`

## 二：精简版是干啥的？

- 答：项目开发请使用精简版，精简版是基于[vue-pure-admin](https://github.com/xiaoxian521/vue-pure-admin)提炼出的架子，包含主体功能，会及时同步代码，更适合实际项目开发，打包大小仅 `3MB`
  ![package](~@alias/img/guide/package.png)

## 三：`husky` 是什么？可以删除 `husky` 提交前校验吗？如何彻底删除？

- `husky` 是什么？  
  答：[官方文档](https://typicode.github.io/husky/#/)

- 可以删除 `husky` 提交前校验吗？  
  答：如果您们提交代码不需要严格的提交前校验，这当然可以删除

- 如何彻底删除？  
  ① 删除根目录 `.husky` 文件夹以及里面所有文件  
  ② 删除根目录 `commitlint.config.js` 文件夹以及里面所有文件  
  ③ 来到 `package.json` 下的 `devDependencies` ，删除 `@commitlint/cli` 、 `@commitlint/config-conventional` 、 `husky` 、 `lint-staged` 、 `pretty-quick` 这些依赖  
  ④ 来到 `package.json` 下的 `scripts` ，删除 `"lint:lint-staged": "lint-staged -c ./.husky/lintstagedrc.js"` 、 `"lint:pretty": "pretty-quick --staged"` 、
  `"prepare": "husky install"` 这些命令

## 四：为什么使用 `pnpm` ？ `pnpm` 天生支持 `monorepo`，为什么项目不采用这种模式呢？可以不使用 `pnpm` 吗？如何从 `pnpm` 切换到 `yarn` ?

- 为什么使用 `pnpm`？  
  ① 节约磁盘空间并提升安装速度  
  当使用 `npm` 或 `Yarn` 时，如果您有 `100` 个项目使用了某个依赖，就会有 `100` 份该依赖的副本保存在硬盘上。 对于 `pnpm` ，依赖项将存储在一个内容可寻址的仓库中，因此：如果您用到了某依赖项的不同版本，那么只会将有差异的文件添加到仓库。例如，如果它有 `100` 个文件，而新版本只改变了其中 `1` 个文件。那么 `pnpm update` 只会向存储中心添加 `1` 个新文件，不会仅因为单一的改变而克隆整个依赖。所有文件都会存储在硬盘上的同一位置。 当多个包（`package`）被安装时，所有文件都会从同一位置创建硬链接，不会占用额外的磁盘空间。 这允许您跨项目地共享同一版本的依赖。最终您节省了大量与项目和依赖成比例的硬盘空间，并且拥有更快的安装速度！  
  ② 创建非扁平化的 `node_modules` 文件夹  
  当使用 `npm` 安装依赖时，所有的依赖都会被提升到模块的根目录。 因此，项目可以访问到未被添加进 当前 项目的依赖。`pnpm` 使用软链的方式将项目的直接依赖添加进模块文件夹的根目录。

- `pnpm` 天生支持 `monorepo`，为什么项目不采用这种模式呢？  
  答：我们先来简单介绍一下什么是 `monorepo` ，`monorepos` 指单一代码库，在版本控制系统的单个代码库里包含了许多项目的代码，与它对应的是 `multirepos` 多代码库，每个项目都储存在一个完全独立的、版本控制的代码库中。`monorepo` 可能并不适合大多数项目，毕竟大家习惯了多代码库开发，所以平台不采用这种模式。  
  [推荐文章:Monorepo 可能没您想象中那么香](https://baijiahao.baidu.com/s?id=1663844045880515134&wfr=spider&for=pc)

- 可以不使用 `pnpm` 吗？  
  答：可以的

- 如何从 `pnpm` 替换到 `yarn`（ `npm` 替换方法同下）  
  替换方法：来到根目录 `package.json` 文件，删除 `"pnpm": ">= 6"` 和 `"preinstall": "npx only-allow pnpm"` ，然后将 `pnpm` 全部换成 `yarn` 即可  
  ![yarn](~@alias/img/guide/yarn.png)

::: warning

`vue-pure-admin` 在 `3.5.0` 版本移除了 `cross-env`，采用 `pnpm` 中 [shell-emulator](https://pnpm.io/zh/cli/run#shell-emulator)这个配置项替代。如果您替换成了 `yarn` 或者 `npm` ，则需要安装 `cross-env`，还原此处的代码即可 [commit](https://github.com/xiaoxian521/pure-admin-thin/commit/820f724d5bec14951cbe81d7c6984451de66d93b#diff-7ae45ad102eab3b6d7e7896acd08c427a9b25b346470d7bc6507b6481575d519)

:::

## 五：项目出现报错 `Cannot find module '@zougt/some-loader-utils'`

- 为什么会出现 `Cannot find module '@zougt/some-loader-utils'`  
  答：项目路径请不要使用中文命名！！！会造成解析乱码！！！请使用全英文路径！！！

## 六：项目出现报错 `Access is denied`（windows 常见）

![error](~@alias/img/guide/error1.png)

- 解决办法：请遵循平台要求，安装对应的 `node` 和 `pnpm` 版本 ( `node` 16 版本及以上、`pnpm` 6 版本及以上)，当然很推荐使用 [nvm](https://www.runoob.com/w3cnote/nvm-manager-node-versions.html)这款 `node` 管理工具，可以自由切换您的 `node` 版本。

## 七：安装依赖时出现报错 `Cannot find module 'sass'`

![sass](~@alias/img/guide/sass.png)

答：删除项目的 `pnpm-lock.yaml` 和 `node_modules` ，重新执行命令 `pnpm install` 安装依赖即可。（重点：文件存放路径不要带有中文）

## 八：动态路由刷新出现警告 ⚠️

- 为什么会出现警告？会不会影响使用？  
  答：这个警告是 `vue-router` 作者故意留下的，咱也不知道为啥，详情看 [issues](https://github.com/vuejs/router/issues/521#issuecomment-706680593)。不会影响使用，功能一切表现正常，项目打包部署到生产环境就不会出现警告了。

## 九：项目出现警告 `rank only the home page can be 0` ⚠️

![rank](~@alias/img/guide/rank.png)

答：路由 `meta` 里的 `rank` 字段只有 `home` 路由才能是 `0` ，其他均不能为 `0` 。作为一种规范，`rank` 字段最好唯一。`rank` 字段代表菜单的排序，而且只能是顶级菜单进行排序，也就是最外层的菜单，为什么这么设计呢。详见[issues/154](https://github.com/xiaoxian521/vue-pure-admin/issues/154#issuecomment-996571156)。

## 十：为什么平台使用 `lodash-unified` ，而不是使用 `lodash-es` 呢？

![lodash](~@alias/img/guide/lodash.png)

答：其实 `lodash-unified` 只是对 `lodash-es` 做了 `ESM` (ESModule)格式支持并兼容 `CJS` (CommonJS)格式，`vite` 又是使用原生 `ESM` 文件快速启动。这里需要注意的是 `lodash-unified` 和 `lodash-es` 需要同时安装。  
用法：`import { sum } from "lodash-unified"`

## 十一：为什么平台使用手动按需引入，而不是使用 `unplugin-vue-components` 插件自动按需引入呢？

答：我尝试将 `unplugin-element-plus` 替换成 `unplugin-vue-components` ，但似乎 `unplugin-vue-components` 表现不是太好，整体来说有些问题，可以看看 [unplugin-vue-components/issues](https://github.com/antfu/unplugin-vue-components/issues) 了解一下，而且 `unplugin-vue-components` 不是为 `element-plus` 特供的产物，毕竟 `vite` 等工具还在高速发展，可能会出现一些莫名的问题影响项目，我之前碰到过开发环境没事，打包就凉了（这里是 vite 某个版本的问题），这很坑，所以我感觉手动按需引入更有安全感，毕竟迭代了这么多版本，`unplugin-element-plus` 没出过问题。所以整体来说平台都把很多坑都踩过了，毕竟提供很多人使用，平台应该有这个责任在使用最新技术前进行调研，并在综合考虑下保留相对稳定的东西，给平台带来稳定。当然您也可自行替换成 `unplugin-vue-components` 插件自动按需引入。

## 十二：为什么平台采用全局引入 `element-plus` ，而不是按需引入呢？ 全局引入带来打包沉余，如何处理？ 如何改成按需引入？

- 为什么平台采用全局引入 `element-plus` ，而不是按需引入呢？  
  答：① 经过多次实践，按需引入一个组件库的话，`vite` 的预编译的时间有点长（尤其是性能低的电脑或者您开了很多程序导致 `cpu` 占用过高），所以我们采用了全局引入的方式，不再让它预编译，而是直接加载整个包。② 按需引入会出现 `new dependencies optimized` 的情况，这个情况一旦出现就会使得页面重新加载，如下图，开发体验不好。

![optimized](~@alias/img/guide/optimized.png)
上图的问题，估计是 `vite` 还需进行优化，下图是来自 `vite` 官方开发者的回复[issues](https://github.com/vitejs/vite/issues/7608#issuecomment-1087877492)
![vite](~@alias/img/guide/vite.png)

- 全局引入带来打包沉余，如何处理？  
  答：全局引入，打包不会在进行 `tree shanking` ，带来未引用的代码也打包进来，造成沉余问题。如何解决呢。目前来说只能在打包时，项目改用 `unplugin-element-plus` 插件按需引入模式，开发时，再换成全局引入。

- 如何改成按需引入？  
  答：以 [精简版](https://github.com/xiaoxian521/pure-admin-thin) 为例。  
  ① 安装 `unplugin-element-plus` ，执行命令：
  ```sh
    pnpm add unplugin-element-plus -D
  ```
  ![ep1](~@alias/img/ep/ep1.png)
  ② 来到根目录 `build/plugins.ts` 文件，去掉 `import ElementPlus from "unplugin-element-plus/vite";` 和 `ElementPlus({}),` 的代码注释  
  ![ep2](~@alias/img/ep/ep2.png)
  ③ 来到根目录 `src/main.ts` 文件，注释 `import ElementPlus from "element-plus";` ，添加 `import { useElementPlus } from "/@/plugins/element-plus";` ，将 `use(ElementPlus)` 替换成 `use(useElementPlus)`
  ![ep3](~@alias/img/ep/ep3.png)
  ④ 千万别忘记，把用到的 `element-plus` 组件引入到根目录 `src/plugins/element-plus/index.ts` 文件中
  ![ep4](~@alias/img/ep/ep4.png)

## 十三：vertical 模式下左侧菜单卡顿，如何解决？菜单切换卡顿？

- vertical 模式下左侧菜单卡顿，如何解决？  
  答：这个问题大多数出现在 `windows` 上，特别是电脑性能低或者双屏的模式下。我的电脑从未出现过卡顿的情况。下图是我的电脑信息
  ![mac](~@alias/img/guide/mac.png)

`element-plus` 的 `menu` 在上述的情况可能会出现卡顿，下面是群友提供的视频。
<video width="320" height="240" controls>
  <source :src="$withBase('/video/ep.mov')" type="video/mp4">
</video>

解决办法：

运行 window + x 打开计算机管理界面，找到设备管理器(或者英文 Device Manager)，打开显示适配器(或者英文 Display Adapters)，如果列表内展示的有 Inter(R) HD Graphics，则说明此电脑具有集成显卡，禁用掉此项（集成显卡），将独立显卡开启满载状态。[Windows 怎么禁用集成显卡](https://jingyan.baidu.com/article/fd8044fae944b61131137ab1.html) <Badge text="推荐文章"/>

- 菜单切换卡顿？  
  答：有人问平台演示环境菜单切换卡顿，是什么问题？  
  ① 首先，平台的演示环境使用的是 [vercel](https://vercel.com/) ，一个免费的静态网站部署服务，在不同的地区，加载资源的速度都不相同，切换菜单的时候，需要加载网络资源，走了请求，响应越慢，页面显示的越慢。  
  ② 其次，本地运行平台的完整版，有的菜单切换卡顿，因为也要加载资源啊，比如地图什么的，当前页面加载资源越大，正常情况下响应就越慢，这是最基本的知识哦。

## 十四：浏览器控制台打印一些重复信息，很影响开发体验，如何解决？

![log](~@alias/img/guide/log.png)

答：如下图所示，触发了 `vite` 的 `hmr update` 就会在控制台输出相对应的信息 [issues](https://github.com/vitejs/vite/issues/1785) ，有时候输出的信息对于我们来说并没有用，是否可以屏蔽掉这些信息呢？当然可以，在浏览器控制台过滤框中输入您不需要的信息并在最前面加上 `-` 即可。[浏览器控制台过滤无用的提示和报错](https://blog.csdn.net/qq_33674300/article/details/114764718) <Badge text="推荐文章"/>

![hotlog](~@alias/img/guide/hotlog.png)

## 十五：vue3 的 `<script setup>` 写法，虽然会依据它的文件名来自动推断组件名称 name，但这也约束了我们的写法，不算灵活，有没有解决方案呢？

答：有的。有人在 vue 上提了这个 issues：`use <script setup name="cpnName"> instead of two <script>`，这种写法无疑是非常方便的，但是被尤大否决了，具体可看[issues](https://github.com/vuejs/core/issues/5218)，不过周边生态出了个插件[unplugin-vue-define-options](https://www.npmjs.com/package/unplugin-vue-define-options)可以在一个 `setup` 里加入 `name` ，很方便。用法如下

```sh
<script setup lang="ts">
defineOptions({
  name: "页面名称"
});
</script>
```

## 十六：vue3 单文件支持多个根标签，但是平台为什么不能这么用呢？如何解决？

- 平台为什么不能这么用呢？  
  答：因为平台用了 `vue3` 中 `Transition` 组件包裹整个内容区，这样才能带来各种页面切换效果。但是 `Transition` 仅支持单个元素或组件作为其插槽内容。如果内容是一个组件，则该组件也必须只有一个根元素，所以这才要求内容区里的单文件要在最外层加上一个根元素。[Transition 组件](https://vuejs.org/guide/built-ins/transition.html#the-transition-component) <Badge text="vue3文档"/>

- 如何解决？  
  答：如果想内容区的单文件支持多个根元素，可以来到这里 [appMain.vue](https://gitee.com/yiming_chang/pure-admin-thin/blob/main/src/layout/components/appMain.vue#L46) 将 `Transition` 以及相关地方删除，不在要页面内容过渡效果了。

## 十七：不同项目的本地存储设置可能不同（页面效果不同），那么如何避免 `fork` 项目的本地存储 `key` 值一样呢？

- 平台使用的 [响应式本地存储](https://github.com/xiaoxian521/responsive-storage)，默认的 `key` 全部以 `responsive-` 开头，如下图所示

![namespace](~@alias/img/guide/namespace.jpg)

- 如何避免？  
  答：您可以修改此处 [代码](https://gitee.com/yiming_chang/vue-pure-admin/blob/main/src/utils/responsive.ts#L6) `nameSpace` 的值即可
